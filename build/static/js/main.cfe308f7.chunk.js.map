{"version":3,"sources":["utils/common.js","images/edit-icon.svg","constants/index.js","components/StockItem.js","components/PositionItem.js","components/Position.js","components/Stock.js","App.js","serviceWorker.js","index.js"],"names":["getStockCodes","stocks","map","code","isNaN","toLowerCase","indexOf","toUpperCase","replace","genFnForBC","stock","bcFn","position","price","costPrice","soryBy","key","type","calcFnResult","formula","targetValue","ratio","i","flag","realValue","formulaStr","result","eval","x","module","exports","STOCKS","name","caclClass","number","StockItem","data","url","bcLinkData","eq","color","window","String","Math","abs","earnRate","toFixed","jcLinkData","jcFn","linkData","base64","btoa","JSON","stringify","calcLink","open","this","props","earningsPerShare","earningCls","advice","className","onClick","handleLinkClick","percent","floor","ceil","Component","SCHEMA","required","postion","PostionItem","state","handleInputChange","e","console","log","target","value","setState","onComplete","isValid","validateShema","Object","keys","every","schemaKey","rule","edit","placeholder","onChange","Position","handleComplete","reduce","alert","push","core","$","TYPE_MAP","asce","desc","Stock","setSotcks","serverData","stockMap","values","sum","symbol","localStock","stockItem","handleSortChange","sort","hanldPostionClick","showPostion","fetchStocks","setInterval","clearInterval","stockCodes","_this","ajax","dataType","join","success","status","xhr","error","split","sortedStocks","s1","s2","src","EditIconSrc","alt","App","Boolean","location","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.cfe308f7.chunk.js","sourcesContent":["// 对股票id进行处理\nexport function getStockCodes(stocks = []) {\n  return stocks.map((code) => {\n      if(isNaN(code[0])){\n          if(code.toLowerCase().indexOf('us_') > -1){\n              return code.toUpperCase();\n          }else if(code.indexOf('hk') > -1){\n              return code;\n          }else{\n              return code.toLowerCase().replace('sz', '1').replace('sh', '0');\n          }\n          \n      }else{\n          return (code[0] === '6' ? '0' : '1') + code;\n      }\n  });\n}\n\n// 生成补仓函数\nexport function genFnForBC(stocks = []) {\n  return stocks.map(stock => {\n    \n    stock.bcFn = `((${stock.position}+x)${stock.price})/(${stock.costPrice}*${stock.position} + ${stock.price}x)`;\n    return stock;\n  });\n}\n\nexport function soryBy(key, type) {\n  \n}\n\n/**\n * 根据反比函数公式，求一个最小近似值\n * @param {*} formula 公式，变量为x\n * @param {*} targetValue 目标值\n */\nexport function calcFnResult(formula = '', targetValue) {\n  const ratio = 100;\n  let i = 1;\n  let flag = true;\n  let realValue = targetValue;\n\n  while(flag) {\n    const formulaStr  = formula.replace(/x/g, `*${ratio * i}`);\n    const result = eval(formulaStr);\n    if(result <= targetValue) {\n      realValue = result;\n      flag = false;\n    } else {\n      i++;\n    }\n    // 设置边界值，大于100不在循环，避免进入死循环\n    if(i > 100) {\n      flag = false;\n    }\n  }\n  return { x: ratio*i, targetValue, realValue };\n}","module.exports = __webpack_public_path__ + \"static/media/edit-icon.47681e14.svg\";","// 第三方股市报价api\nexport const API_BASE_URL = 'https://api.money.126.net/data/feed/';\n\n// 第三方股市财务api\nexport const API_QUOTE_URL = 'https://stock.xueqiu.com/v5/stock/quote.json';\n\n// 刷新间隔（毫秒）\nexport const UPDATE_INTERVAL = 3000;\n\n// 期望承受亏损比率\nexport const EXPECT_LOSS_RATE = 0.03;\n\n// 持仓股\nexport const STOCKS = [\n  {\n    name: '伊利股份',\n    // 股票代码\n    code: '600887',\n    // 成本价\n    costPrice: 30.243,\n    // 仓位，多少股\n    position: 400,\n  },\n  {\n    name: '中国平安',\n    // 股票代码\n    code: '601318',\n    // 成本价\n    costPrice: 77.987,\n    // 仓位，多少股\n    position: 200,\n  },\n  {\n    name: '格力电器',\n    // 股票代码\n    code: '000651',\n    // 成本价\n    costPrice: 60.625,\n    // 仓位，多少股\n    position: 200,\n  },\n  {\n    name: '东山精密',\n    // 股票代码\n    code: '002384',\n    // 成本价\n    costPrice: 28.213,\n    // 仓位，多少股\n    position: 400,\n  },\n  {\n    name: '华天科技',\n    // 股票代码\n    code: '002185',\n    // 成本价\n    costPrice: 12.870,\n    // 仓位，多少股\n    position: 100,\n  },\n  {\n    name: '华新水泥',\n    // 股票代码\n    code: '600801',\n    // 成本价\n    costPrice: 23.813,\n    // 仓位，多少股\n    position: 400,\n  },\n  {\n    name: '海螺水泥',\n    // 股票代码\n    code: '600585',\n    // 成本价\n    costPrice: 51.851,\n    // 仓位，多少股\n    position: 100,\n  },\n];\n","import React, { Component } from 'react';\nimport { calcFnResult } from '../utils/common';\nimport { EXPECT_LOSS_RATE } from '../constants';\n\nimport './StockItem.scss';\n\nfunction caclClass(number) {\n  if (number > 0) {\n    return 'red';\n  } else if (number < 0) {\n    return 'green';\n  } else {\n    return 'default';\n  }\n}\n\nfunction calcLink(data) {\n  const bcLinkData = [\n    { type: 0, eq: data.bcFn, color: '#13AD13' },\n    { type: 1000, window: ['-200', '1500', '0', String(Math.abs(data.earnRate * (1.5).toFixed(2)))] },\n  ];\n  const jcLinkData = [\n    { type: 0, eq: data.jcFn, color: '#ED1717' },\n    { type: 1000, window: ['-100', '500', '0', String(Math.abs(data.earnRate * (1.5).toFixed(2)))] },\n  ];\n  const linkData = data.costPrice > data.price ? bcLinkData : jcLinkData;\n  // replace这一步是因为绘图网站http://fooplot.com的base64算法使用-代替=填充\n  const base64 = window.btoa(JSON.stringify(linkData)).replace(/=/g, '-');\n\n  return `http://fooplot.com/#${base64}`;\n}\n\nexport default class StockItem extends Component {\n  // 点击补仓函数跳转至函数绘图网站\n  handleLinkClick(data) {\n    const url = calcLink(data);\n    window.open(url, data.name);\n  }\n\n  render() {\n    const { data } = this.props;\n    // 每股收益\n    const earningsPerShare = data.price - data.costPrice;\n    const earningCls = caclClass(earningsPerShare);\n\n    // 计算达到预期亏损的补仓建议\n    let advice = {};\n    if (earningsPerShare < 0 && data.earnRate <= -0.059) {\n      advice = calcFnResult(data.bcFn, EXPECT_LOSS_RATE);\n    }\n\n    return (\n      <div className=\"stock-item\">\n        <h3>{data.name}</h3>\n        <div className=\"stock-spc-item\">\n          <label className=\"stock-item-label\">{earningsPerShare < 0 ? '补仓函数' : '加仓函数'}:</label>\n          <span\n            className=\"stock-item-value link\"\n            onClick={() => {\n              this.handleLinkClick(data);\n            }}\n          >\n            {earningsPerShare < 0 ? data.bcFn : data.jcFn}\n          </span>\n        </div>\n        <div className=\"stock-spc-item\">\n          <label className=\"stock-item-label\">盈亏:</label>\n          <span className={`stock-item-value ${earningCls}`}>{(data.earnRate * 100).toFixed(3)}%</span>\n        </div>\n        <div className=\"stock-spc-item\">\n          <label className=\"stock-item-label\">成本:</label>\n          <span className=\"stock-item-value\">{data.costPrice}</span>\n        </div>\n        <div className=\"white-blank\"></div>\n        <div className=\"stock-spc-item\">\n          <label className=\"stock-item-label\">现价:</label>\n          <span className=\"stock-item-value\">{data.price}</span>\n        </div>\n        <div className=\"stock-spc-item\">\n          <label className=\"stock-item-label\">涨幅:</label>\n          <span className={`stock-item-value ${caclClass(data.percent)}`}>{(data.percent * 100).toFixed(2)}%</span>\n        </div>\n        <div className=\"white-blank\"></div>\n        {advice.x && (\n          <div className=\"stock-spc-item advice-item\">\n            <label className=\"stock-item-label\">建议:</label>\n            <span className=\"stock-item-value advice-value\">\n              目前您的亏损超过了{Math.floor(Math.abs(data.earnRate) * 100)}%。建议补仓<b className=\"mark\">{advice.x}</b>\n              手， 需要资金\n              <b className=\"mark\">¥{Math.ceil(data.price * advice.x)}</b>, 可将亏损降至\n              <b className=\"mark\">{(advice.realValue * 100).toFixed(3)}%</b>。\n            </span>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\n\nimport './PositionItem.scss';\n\nconst SCHEMA = {\n  name: {\n    required: true,\n  },\n  code: {\n    required: true,\n  },\n  costPrice: {\n    required: true,\n  },\n  postion: {\n    required: true,\n  },\n};\n\nexport default class PostionItem extends Component {\n  state = {\n    stock: {},\n  };\n\n  // handle input item change\n  handleInputChange = (key, e) => {\n    const { stock } = this.state;\n    console.log('e', e.target.value);\n    this.setState(\n      {\n        stock: {\n          ...stock,\n          [key]: String(e.target.value).replace(/\\s/g, ''),\n        },\n      },\n      () => {\n        const { onComplete } = this.props;\n        const isValid = this.validateShema();\n\n        isValid && onComplete({...this.state.stock});\n        console.log('isValid', isValid);\n      },\n    );\n  };\n\n  validateShema = () => {\n    const { stock } = this.state;\n\n    return Object.keys(SCHEMA).every(schemaKey => {\n      const rule = SCHEMA[schemaKey];\n\n      if (stock[schemaKey]) {\n        return rule.required ? stock[schemaKey] : true;\n      } else {\n        return !rule.required;\n      }\n    });\n  };\n\n  render() {\n    const { edit = false, data = {} } = this.props;\n    return (\n      <div className=\"postion-item-box\">\n        {edit ? (\n          <div className=\"position-edit-item\">\n            <div className=\"col stock-name\">\n              <input type=\"text\" placeholder=\"[可填]名称\" onChange={e => this.handleInputChange('name', e)} />\n            </div>\n            <div className=\"col stock-code\">\n              <input type=\"text\" placeholder=\"* 代码\" onChange={e => this.handleInputChange('code', e)} />\n            </div>\n            <div className=\"col stock-cost-price\">\n              <input type=\"number\" placeholder=\"* 成本\" onChange={e => this.handleInputChange('costPrice', e)} />\n            </div>\n            <div className=\"col stock-postion\">\n              <input type=\"number\" placeholder=\"* 持仓(股)\" onChange={e => this.handleInputChange('postion', e)} />\n            </div>\n          </div>\n        ) : (\n          <div className=\"position-show-item\">\n            <div className=\"col stock-name\">{data.name}</div>\n            <div className=\"col stock-code\">{data.code}</div>\n            <div className=\"col stock-cost-price\">{data.costPrice}</div>\n            <div className=\"col stock-postion\">{data.position}</div>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PositionItem from './PositionItem';\n\nimport './Position.scss';\n\nexport default class Position extends Component {\n  componentDidMount() {\n    const { stocks = [], core } = this.props;\n\n    this.stocks = stocks;\n    core && core(this);\n  }\n\n  handleComplete = data => {\n    const { stocks = [] } = this.props;\n    this.stocks = stocks;\n    const stocksMap = stocks.reduce((map, stock) => {\n      map[stock.code] = stock;\n      return map;\n    }, {});\n\n    if(stocksMap[data.code]) {\n      alert('该股票已存在了，你可以点击修改~');\n    } else {\n      this.stocks.push(data);\n    }\n  };\n\n  render() {\n    const { stocks } = this.props;\n    return (\n      <div className=\"stocks-list-wrap\">\n        <div className=\"postion-list-header\">\n          <div className=\"th\">名称</div>\n          <div className=\"th\">代码</div>\n          <div className=\"th\">成本</div>\n          <div className=\"th\">持仓</div>\n        </div>\n        {stocks.map(stock => (\n          <PositionItem key={stock.code} data={stock}  onComplete={this.handleComplete} />\n        ))}\n        {/* <PositionItem data={{}} edit={true} onComplete={this.handleComplete} /> */}\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport StockItem from './StockItem';\nimport { getStockCodes } from '../utils/common';\nimport { API_BASE_URL, STOCKS, UPDATE_INTERVAL } from '../constants';\n// import MOCK_DATA from './mockdata';\nimport EditIconSrc from '../images/edit-icon.svg';\nimport Position from './Position';\n\nimport './Stock.scss';\n\nconst $ = window.$;\nconst TYPE_MAP = {\n  asce: 1,\n  desc: -1,\n};\n\nlet timer = null;\n\nexport default class Stock extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      stocks: [],\n      sort: 'default',\n      showPostion: false,\n    };\n  }\n\n  componentDidMount() {\n    this.fetchStocks();\n    // this.setSotcks(MOCK_DATA);\n    setInterval(() => {\n      this.fetchStocks();\n    }, UPDATE_INTERVAL);\n  }\n\n  componentWillUnmount() {\n    clearInterval(timer);\n  }\n\n  fetchStocks() {\n    const stockCodes = STOCKS.map(stock => String(stock.code));\n    const _this = this;\n\n    $ &&\n      $.ajax({\n        type: 'GET',\n        dataType: 'jsonp',\n        url: `${API_BASE_URL}${getStockCodes(stockCodes).join(',')}`,\n        success: function(serverData, status, xhr) {\n          _this.setSotcks(serverData);\n        },\n        error: function(e) {\n          console.error('请求接口错误');\n        },\n      });\n  }\n\n  setSotcks = serverData => {\n    const stockMap = Object.values(serverData).reduce((sum, stock) => {\n      sum[stock.symbol] = stock;\n      return sum;\n    }, {});\n    // 合并成本价、持仓信息\n    const stocks = STOCKS.map(localStock => {\n      if (stockMap[localStock.code]) {\n        const stockItem = {\n          ...localStock,\n          ...stockMap[localStock.code],\n        };\n        const { costPrice, price, position } = stockItem;\n\n        if (costPrice > price) {\n          stockItem.bcFn = `1-(${(position * price).toFixed(2)}+${price}x)/(${costPrice}*${position}+${price}x)`;\n        } else {\n          stockItem.jcFn = `(${(position * price).toFixed(2)}+${price}x)/(${costPrice}*${position}+${price}x)-1`;\n        }\n        stockItem.earnRate = price / costPrice - 1;\n        return stockItem;\n      } else {\n        return localStock;\n      }\n    });\n\n    this.stocks = [...stocks];\n    this.setState({\n      stocks,\n    });\n  };\n\n  handleSortChange = e => {\n    this.setState({\n      sort: e.target.value,\n    });\n  };\n\n  hanldPostionClick = (type) => {\n    console.log('click', type);\n    this.setState({\n      showPostion: !this.state.showPostion,\n    });\n    if(type === 'save') {\n      console.log('持仓', this.core.stocks);\n    }\n  };\n\n  render() {\n    const { stocks, sort, showPostion } = this.state;\n    const [key, type] = sort.split(':');\n    let sortedStocks = [...stocks];\n\n    if (key === 'default') {\n      sortedStocks = this.stocks || [];\n    } else {\n      const ratio = TYPE_MAP[type] || 1;\n      sortedStocks = stocks.sort((s1, s2) => (s1[key] - s2[key]) * ratio);\n    }\n\n    return (\n      <div className=\"stock-list-wrap\">\n        <h2>STOCK HELPER</h2>\n        <div className=\"tools-box\">\n          <div className=\"sort-tool\">\n            sort by\n            <select onChange={this.handleSortChange}>\n              <option value=\"default\">default</option>\n              <option value=\"earnRate:asce\">盈亏⬆</option>\n              <option value=\"earnRate:desc\">盈亏⬇</option>\n            </select>\n          </div>\n          <div className=\"position-tool\" onClick={() => this.hanldPostionClick(showPostion ? 'save' : 'edit')}>\n            <span>{showPostion ? '保存' : '持仓'}</span>\n            <img src={EditIconSrc} alt=\"edit-icon\" />\n          </div>\n        </div>\n        {showPostion && <Position core={core => this.core = core} stocks={this.stocks || []} />}\n        <div>\n          {sortedStocks.map(stock => (\n            <StockItem key={stock.code} data={stock} />\n          ))}\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport Stock from './components/Stock';\n\nimport './App.scss';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n       <Stock />\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}